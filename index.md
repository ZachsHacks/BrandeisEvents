<img src="https://s3.amazonaws.com/campusnow-images/Image-Screenshots-Website/Screen+Shot+2017-05-07+at+10.46.56+PM.png" alt="CampusNow Home Page" style="margin-top:20px;"/>

### [](#header-3)Introduction
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CampusNow is a service for universities that allows students to easily find campus events that they are interested in. Currently the application is exclusive to Brandeis students, faculty, and staff. Without signing in, anyone can search and find events with ease. They can search by date, name, description, category, or location. When signed in, Brandeis users are able to save events that they are either going to or interested in, see events that are recommended for them, save events to their calendar, and receive text message reminders about the event. The event page shows a user every piece of information you would expect about the event; title, description, price, date and time, distance from a user's location, RSVP buttons, tags, location, and a map. Events can be added to the website by approved hosts. All of this is possible on an easy to use and attractive interface. <br/>
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;At Brandeis there are currently a few ways for students to find out about events. Events are shared on Facebook groups, displayed on posters around campus, or listed in an illegible large weekly email that the student body receives. There are many problems with all of these. Facebook groups are ignored as spam, posters are left up late after events have taken place, and the weekly email is poorly formatted with different fonts, font sizes, and colors. Because of this, posters have prevailed as the best option on campus, but there are many times when students do not see the poster until the event has concluded. Sometimes these posters are lacking in information. For example, listing an event as happening on “Thursday” is obviously confusing, not to mention that posters are a waste of paper and ugly to look at when left up too long. Brandeis also offers a website called BrandeisEvents, which is another way that events are displayed to the student body, but this website is poorly designed and is an old fashioned calendar list. We aim to solve this issue and fill the void by providing our product, CampusNow. 


### [](#header-3)API’s and Gems
*The Parser* <br/>
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;One of our most exciting accomplishments for CampusNow came after we discovered the possibility that we could parse the XML feed from Brandeis Events. We used XML parsers such as [Nokogiri](https://github.com/sparklemotion/nokogiri), [Crack](https://github.com/jnunemaker/crack), and [Typhoeus](https://github.com/typhoeus/typhoeus) to grab the data and meticulously process it through a multitude of steps. First, we created a “BrandeisEvents” user to host all of the feed’s events. Next, certain elements like the title were easy to obtain with the parser. Additionally, the description comes in as a block of HTML. In order to provide the same amount of information (specific format such as bold and italics), we decided to keep most of the HTML intact and to just remove certain elements from the start and end. Then using the description, we created a separate tool to generate tags. This worked by taking each of our predetermined tags and for each tag, looking up one hundred related words, which are stored in a hash, and entering them into a reverse hash map. This way, when we search through each event description, the tags would likely map to our tags. This has a few flaws, but ideally we would like to implement a machine learning algorithm for the future. We even tried using the Twinword API, which takes a block of text and generates keywords, and while it was headed in the right direction, it wasn’t consistent enough for us to use as our daily driver. Generating tags is only an issue for events from the feed, because hosts manually choose tags when creating an event. In order to prevent our app from doing the same work for each seed, we stored the related words into a JSON file “tag_dictionary.rb” in the db folder. To generate images, we used the Getty Images API and queried the title in an image search. This is further discussed below, but unfortunately, adding these calls made our app much slower. We hope to memorize repeating results into a file for future expedited seeding. Our website database is updated hourly through background processing to reflect new events on the feed.	
*Location* <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;With our product being an event aggregator for the Brandeis campus, a user's current location is of the utmost importance. Therefore, from both an UI and a development standpoint, we wanted location to play an important role. This became the reasoning behind the fact that underneath the title of an event; the time to drive, bike, and walk are first and foremost. This allows college students, who often use different means of transportation, to know the feasibility of getting to an event. This is especially important since many students do not have a car or a bike. At first, a user’s location was determined with the help of the[geocoder](https://github.com/alexreisner/geocoder) Rails gem. This gem used a user’s IP address to estimate an address. From there, we customized the gem,[google-directions-ruby](https://github.com/joshcrews/google-directions-ruby), to provide time to destination by way of driving, biking, and walking. However, after weeks of discussion, we decided that giving exact minute directions based on an IP address wasn’t always accurate, so we set out to implement the[JavaScript html5 geolocation API](https://developers.google.com/maps/documentation/javascript/examples/map-geolocation). The issue that first arose was the fact that the coordinates (which are determined extremely accurately with the help of router strength, GPS, and other factors), are only determined once the view is loaded. This caused significant issues and rethinking of its implementation. In the end, after many StackOverflow questions, we decided to create a location cookie. This cookie is created through JavaScript and expires after a variable amount of time (currently 10 minutes). The cookie is created in the application controller, implemented through a conditional in the header view and stores a user’s location coordinates, from the very first page viewed. Therefore, by the time a user is on an event page, their exact coordinates are known (similar to using Google Maps), and thus a much more accurate description of time to destination are displayed. Furthermore, by implementing a custom cookie, the user is not prompted on every page to allow their location. With the user’s location accessible, the [Google Maps](https://developers.google.com/maps/documentation/javascript/) API is used to provide an overview of the driving route as shown on the bottom of the page. The map shows both the starting and destination points and the corresponding route. Finally, if the user decides to block the location API which is an option on some browsers, a user’s location is determined by IP address.

*Calendar Subscription* <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;To allow users to save important events, we gave them the ability to subscribe to a personal calendar. With the help of the [ical](https://github.com/icalendar/icalendar) Rails gem, a custom ical calendar feed can be generated from a user’s dashboard and can be easily subscribed to using Apple Calendar, Google Calendar, or a similar service.

*Twilio SMS Reminders* <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Furthermore, since we want it to be as easy as possible for people to keep track of events, Twilio SMS was implemented. When a user clicks the RSVP or Interested button on an event, they are automatically enrolled (unless they opted out during account creation) in a text message reminder and the event is added to their calendar feed. Sixty minutes prior to an event, the user will receive a text. For example, “Hi Aaron. Just a reminder that you have an Event (Celebration of Service) coming up in 60 minutes at 07:00PM on May. 01, 2017. The event can be viewed at [campusnow.herokuapp.com/events/65](http://campusnow.herokuapp.com/events/65).” These texts are added to a background processing queue as described below.


### [](#header-3) Background Processing
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Background processing became central to our app in two ways. The first was with updating our feed, while the second was the ability to queue texts for later delivery. With the feed in place, it is important to be able to update our database when new events from the Brandeis administration are created. Therefore, background processing was implemented. At first we tried to use Sidekiq, but the redis instances required were more than the free tier Heroku allowed. Therefore we implemented [Heroku Scheduler](https://elements.heroku.com/addons/scheduler). With Heroku Scheduler, our database is re-seeded every hour. The “find_or_create_by” ActiveRecord call allows us to easily update our database with new events. Secondly, [Delayed::Job](https://github.com/collectiveidea/delayed_job)  was used to automatically, and in the background, send text messages. When a user presses the RSVP or interested button on an event, a custom text message with a send date is stored in the delayed_jobs database (a table found in our schema).  From here, a workless worker insures that the queue is being processed and thus sends off texts. Unfortunately, as of now, Heroku shuts down our server after 30 minutes of inactivity and thus texts are not sent if the server is offline.  In the future, additional background processing will be included into our application so that a user’s recommended events are calculated in the background instead of at time called. Ever since the introduction of the Brandeis XML feed and background scheduler, we all agreed that this application was headed in a serious direction of potential adoption by the university.
### [](#header-3) User Interface

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The UI for CampusNow was designed to allow college students to easily and swiftly find events. Currently there is no continuity between fliers, Facebook events, and the Brandeis feed.  The design was meant to be simple on the eye, and easy to navigate. The base of the UI came from Bootstrap. At first, we only showed three events, however, after user testing we soon discovered that if promoting events was the most important thing, then more events per a row should be showed. Furthermore, since our website was created to allow users to easily find and attend events, after further testing with potential users, the first thing noticed was the images. Potential users said that they first look at images even before the title. Therefore, we knew this would be important. The problem that we faced was that the majority of our events came from a Brandeis feed that didn’t include images. Until recently, we used a default placeholder image with the Brandeis logo, but for mainstream use this wasn’t feasible. Therefore, the Getty stock image API was implemented into our application to populate images. Unfortunately, although we hoped to search the entire title of an event, many times no photos were found. Therefore, the images are determined based on the first two words of an event's title. Although this isn’t always foolproof, it is more accurate than before. Additionally, when tags are even more accurate, they will be used to determine the image. Furthermore, for recurring events at Brandeis that have caused issues with the API, a custom hash which is populated during the seed from the Image_name_dictionary file, replaces API query with a more exact query. By using the Getty API, our application uses the top photos from professional photographers. This prevents against poor images on Google. Unfortunately, at this point, without a license to Getty, we are forced to use degraded photos. With a touch of a button, our events in the future, will have beautiful high definition photos.  
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Although user interface is typically thought of as someone using a computer and a browser, CampusNow attempts to breakthrough to the next realm of technology. With easability in finding events important, we created a Facebook Messenger chatbot. Through the bot, a user can easily type a message such as “What events are happening tomorrow” in facebook and receive a response. Additionally, this same type of technology is in the midst of development with Alexa. We hope to complete an Alexa skill in the coming days which will allow extended ease with finding events!

<img src="	https://s3.amazonaws.com/campusnow-images/Image-Screenshots-Website/Screen+Shot+2017-05-08+at+11.16.55+PM.png" alt="CampusNow Individual Event Page" style="margin-top:20px;"/>
*Ajax* <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;	One of the most useful features of our front-end is our use of Ajax to enable significant portions of our pages to only load as needed. Most of our buttons, such as our “Going” and “Interested” buttons, have ajax functionality. Similarly, we have used Ajax to implement the “You Ain’t Gonna Need It” principle of software design on our user dashboard page. The user dashboard was initially html tabs, which rendered every tab’s content upon loading the webpage regardless of whether or not the tab itself was active. However, we had the idea to change those tabs to actually be a series of Ajax buttons followed by a single events partial that would re-render itself as needed. In doing so, we cut the page’s initial workload from four database queries down to one. We even used Ajax to make the user dashboard more responsive to user's’ actions. For example if a user changes their RSVP on an event from “Interested” to “Going”, the dashboard will instantly move to the “Going” tab. In the future, we hope to further the use of Ajax across our product such as in the “Browse Events” page. 

### [](#header-3) Administration & Security

*Admin* <br/>
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Essential to any application that has users and their content, is a need for an administrator and controls that an admin can use. To do this we used a gem called [rails_admin](https://github.com/sferik/rails_admin) which is used to provide an administrator with an admin panel which has a nice UI and is easy to use. This panel is accessed through a link that appears on the website’s header when an administrator is signed in. Because someone with access to the panel could cause serious harm to the website, rails_admin checks users who try to get to the link /admin and if they are not an administrator, it redirects them to the home page of the app.
	
*Security* <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Further, we have secured the application with the gem [Cancancan](https://github.com/CanCanCommunity/cancancan) which is used to make sure that users that are not hosts or admins cannot edit, create, or delete events and other users. This was done by having two boolean fields in the database for users which are is_admin and can_host. By checking these roles when actions are attempted in the controler, we are able to secure the application. Our site is configured to allow admins access to all features of the site including updating and deleting events, users, and tags. Additionally, hosts can update their own events, create new events, and edit their own personal information. Normal users can view the site, RSVP, and edit or delete themselves. Any attempt to access features users are not allowed to do result in our custom 404 page. Upon discovering that we could also access each other’s calendar feeds simply by guessing each other’s ID’s within the database, we redesigned our calendar URL’s to be based on a BCrypt-generated hash of the user’s UID.

### [](#header-3) Shibboleth

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Initially, our app’s authentication was simply based on the instructions from the Ruby on Rails Tutorial which used BCrypt to secure passwords. However, we weren’t happy with the lack of native integration to the Brandeis community. Therefore, we upgraded our authentication to use Google accounts through the [google_oauth2](https://github.com/zquestz/omniauth-google-oauth2) gem. However, since all four of us work at the LTS Help Desk, we all have vast experience with every online service Brandeis offers and we couldn’t help but be fascinated by the one feature that every Brandeis service has: Shibboleth. Shibboleth is Brandeis’s online authentication system and is known to students, faculty, and staff across campus. Implementing Shibboleth seemed daunting even from before the start —   Professor Salas himself posted a StackOverflow question about Shibboleth integration that remains unresolved to this day. This fear was furthered by our friends from a prior Capstone class assuring us that it couldn’t be done. However, between working closely with Sarah Redman, Brandeis’s LTS staff member in charge of Shibboleth, and finding the [omniauth-saml](https://github.com/omniauth/omniauth-saml) gem, we were successfully able to allow users to sign in with their Brandeis credentials. Implementing this approach allows for the instant verification and delivery of a user’s name, email addresses, and role on campus.

### [](#header-3) Testing & Version control
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Our group used Github in conjunction with Codeship. While Github became important for version control and independent work, Codeship was just as relevant in ensuring that bad code was not pushed live. Our group had a number of rules for coding to prevent confusion and conflicts. They were, do not work on the master branch, work on your own instead and before pushing, run tests. These two rules varied in usefulness and use in our project. For example, when we added authorization with cancancan, many of our tests would fail because the fake users were not authorized to do the things they needed for the test. Because we were caught up in the excitement of coding and progress, we were lagging in updating our tests which resulted in us breaking the testing rule for a solid few weeks. However, recently we turned to a more TDD approach and updated our tests to work with the new features. Although we do not have many tests, we have specifically planned each test to be very relevant and have deleted unnecessary tests.  

### [](#header-3) Future ideas
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; We have spent most of the semester concentrating on the non-host user side of functionality. This is mainly because without current widespread usage, the only way to gain traction would be to have Brandeis feed. However, moving forward, we envision CampusNow as less of a beautifier for the Brandeis feed and more as a place where individuals add their own events directly.  Our aim is that this application will have all the events that would traditionally be on the feed (faculty run events) as well as smaller events from clubs on campus. We plan to accomplish this by getting more data from our shibboleth login. Specifically the role of a member of the university. If they are faculty or staff we would make them a host. We would also give certain faculty and staff members administrative abilities to help monitor and decide which student executive board members of clubs could become hosts. This system of administrators and hosts will allow the application to be populated with the events that students want to find. To further make populating the application easy, we plan to implement email parsing so that events can be emailed in to create events. This is important since many events are shared through long and overwhelming event listservs. <br/>
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;An additional important host feature we plan on implementing is a host panel where they can see and edit the events they have created and view how many people have RSVP-ed or responded as interested. Similarly, a feature that we would like to expand upon in the future is recommendations – our recommendation algorithm currently consists of finding any tag of an event that the user has RSVP’d to or has marked as an interest, and then gathers every event with a common tag. In the future, we would like to add a more complex recommendation algorithm, potentially implementing machine learning. <br/>
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Currently our product works most successfully on Safari on Macs. While most features work in other browsers and on other operating systems, we plan to expand the functionality. The lack of complete cross platform functionality is due in part to the fact that our entire team uses apple laptops and the difficulty in debugging in different environments 
	
<img src="	https://s3.amazonaws.com/campusnow-images/Image-Screenshots-Website/Screen+Shot+2017-05-07+at+10.48.31+PM.png" alt="CampusNow Browse Events Page" style="margin-top:20px;"/>
### [](#header-3)Conclusion

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Our app, CampusNow was created because of a general inefficiency of event promoting on campus. Traditionally, it is difficult to find out about events on campus, and even when you do hear about them and get excited, you discover that the event happened last week. CampusNow is the clean, easy to use solution that provides powerful, fast functionality that is user focused. Our app takes advantage of a plethora of unique gems and API’s such as Shibboleth, Getty, and the parser. Our aim is to become the number one place Brandeis students go for information about what events are happening on campus. No matter if it’s on your computer, your phone, or with your voice— finding events has never been so easy! 



	